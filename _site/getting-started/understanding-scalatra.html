<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Scalatra | The Anatomy of a Scalatra Application</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/assets/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="/assets/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/assets/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">
  </head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/">Scalatra</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li><a href="/getting-started">Getting started</a></li>
              <li><a href="/guides">Guides</a></li>
              <li><a href="/news">News</a></li>
              <li><a href="/community">Community</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">

      <h1>The Anatomy of a Scalatra App</h1>

<p>The recommended way of structuring a Scalatra project is as follows:</p>

<pre><code>project

src
|_ main
   |_ scala
   |  |   |_Scalatra.scala &lt;= see note below!
   |  |
   |  |_org
   |      |_yourdomain
   |        |
   |        |_projectname
   |          |_ ArticlesServlet.scala
   |          |_ UsersServlet.scala
   |
   |_ webapp
      |
      |_ WEB-INF
         |
         |_ views
         |  |_ default.jade
         |
         |_ layouts
         |  |_ default.jade
         |
         |_ web.xml
</code></pre>

<h3>Mounting multiple servlets (or filters)</h3>

<p>If you've got more than one servlet or filter in your application, you'll
need to mount them. If you're an old Java hand, you'll be quite comfortable
doing this through the <code>web.xml</code> file in traditional servlet style, but
Scalatra 2.1.x also introduces a more dynamic (and less XML-ish) method
of wiring your app together: the Scalatra bootstrap file.</p>

<p>You can set your web.xml file up like this:</p>

<p>{pygmentize:: xml}
&lt;?xml version="1.0" encoding="UTF-8"?>
&lt;web-app xmlns="http://java.sun.com/xml/ns/javaee"</p>

<pre><code>  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"
  version="3.0"&gt;
&lt;listener&gt;
  &lt;listener-class&gt;org.scalatra.servlet.ScalatraListener&lt;/listener-class&gt;
&lt;/listener&gt;

&lt;servlet-mapping&gt;
  &lt;servlet-name&gt;default&lt;/servlet-name&gt;
  &lt;url-pattern&gt;/img/*&lt;/url-pattern&gt;
  &lt;url-pattern&gt;/css/*&lt;/url-pattern&gt;
  &lt;url-pattern&gt;/js/*&lt;/url-pattern&gt;
  &lt;url-pattern&gt;/assets/*&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
</code></pre>

<p></web-app>
{pygmentize}</p>

<p>Note that there are no servlet-names, servlet classes, etc. It's all handled
dynamically by the ScalatraListener class.</p>

<p>You can then place a file called Scalatra.scala in your <code>src/main/scala</code>
directory. The simplest version of this file might look like:</p>

<p>{pygmentize:: scala}
import org.scalatra.LifeCycle
import javax.servlet.ServletContext
import org.yourdomain.projectname._</p>

<p>class Scalatra extends LifeCycle {</p>

<p>  override def init(context: ServletContext) {</p>

<pre><code>// set init params like this:
org.scalatra.cors.allowedOrigins = "http://example.com:8080 http://foo.example.com"

// mount servlets like this:
context mount (new ArticlesServlet, "/articles/*")
context mount (new UsersServlet, "/users/*")
</code></pre>

<p>  }
}
{pygmentize}</p>

<p>This Scalatra class allows you to mount either servlets or filters (or both)
into your application, and define path patterns that they'll respond to.</p>

<p>It's also a good place to put things like database initialization code, which
need to be set up once in your application.</p>

<h3>Serving Static Files</h3>

<p>Static files can be served out of the <code>webapp</code> folder, which acts as the ROOT
directory. As with any servlet based application, the contents of this directory
are all public, with the exception of files in the WEB-INF directory.</p>

<p>An example structure may help in understanding this.</p>

<pre><code>src
|_ main
   |_ scala
   |  |_ Web.scala
   |_ webapp
      |_ WEB-INF
      |  |_ secret.txt
      |  |_ views
      |  |  |_ default.jade
      |  |
      |  |_ layouts
      |  |  |_ default.jade
      |  |
      |  |_ web.xml
      |- stylesheets
      |    |_ default.css
      |- images
           |_ foo.jpg
</code></pre>

<p>In this application, the only publicly accessible files will be at
<code>stylesheets/default.css</code> and <code>images/foo.jpg</code>. Everything else will be
protected by the web application container.</p>

<h3>ScalatraServlet vs. ScalatraFilter</h3>

<p>There are two base classes you can inherit from in order to make a
Scalatra application: <code>ScalatraServlet</code> and <code>ScalatraFilter</code>.</p>

<p>{pygmentize:: scala}
class YourServlet extends ScalatraServlet with ScalateSupport {
  // your class here
}
{pygmentize}</p>

<p>vs.</p>

<p>{pygmentize:: scala}
class YourFilter extends ScalatraFilter with ScalateSupport {
  // your class here
}
{pygmentize}</p>

<p>The main difference is the default behavior when a route is not found.
A <code>ScalatraFilter</code> will delegate to the next filter or servlet in the chain (as
configured by web.xml), whereas a <code>ScalatraServlet</code> will return a 404
response.</p>

<p>Another difference is that <code>ScalatraFilter</code> matches routes relative to
the WAR's context path. <code>ScalatraServlet</code> matches routes relative to the
servlet path. This allows you to mount multiple servlets in different namespaces
in the same WAR.</p>

<h4>Use ScalatraFilter if:</h4>

<ul>
<li>You are migrating a legacy application inside the same URL space</li>
<li>You want to serve static content from the WAR rather than a
dedicated web server</li>
</ul>


<h4>Use ScalatraServlet if:</h4>

<ul>
<li>You want to match routes with a prefix deeper than the context path.</li>
</ul>


<h1>Understanding Scalatra's SBT Dependencies</h1>

<p>Scalatra uses Scala's <a href="http://www.scala-sbt.org/">Simple Build Tool</a>, or <code>sbt</code>, as a build system.</p>

<p>The <code>build.sbt</code> file defines the libraries which your application will depend on,
so that <code>sbt</code> can download them for you and build your Scalatra project.</p>

<p>Here's an example Scalatra sbt file:</p>

<p>{pygmentize:: scala}
organization := "org.example"</p>

<p>name := "yourapp"</p>

<p>version := "0.1.0-SNAPSHOT"</p>

<p>scalaVersion := "2.9.1"</p>

<p>seq(webSettings :_*)</p>

<p>classpathTypes ~= (_ + "orbit")</p>

<p>libraryDependencies ++= Seq(
  "org.scalatra" % "scalatra" % "2.1.0",
  "org.scalatra" % "scalatra-scalate" % "2.1.0",
  "org.scalatra" % "scalatra-specs2" % "2.1.0" % "test",
  "ch.qos.logback" % "logback-classic" % "1.0.6" % "runtime",
  "org.eclipse.jetty"        % "jetty-webapp"           % "8.1.5.v20120716"     % "container",
  "org.eclipse.jetty"        % "test-jetty-servlet"     % "8.1.5.v20120716"     % "test",
  "org.eclipse.jetty.orbit"  % "javax.servlet"          % "3.0.0.v201112011016" % "container;provided;test" artifacts (Artifact("javax.servlet", "jar", "jar"))</p>

<p>)</p>

<p>resolvers += "Sonatype OSS Snapshots" at "http://oss.sonatype.org/content/repositories/snapshots/"
{pygmentize}</p>

<p>If your project depends on any additional libraries, you may add any other
dependencies you wish into the <code>libraryDependencies</code> section.</p>

<p>The default dependencies are:</p>

<p><code>scalatra</code>: This is the core Scalatra module, and is required to run the framework.</p>

<p><code>scalatra-scalate</code>: This integrates with <a href="http://scalate.fusesource.org">Scalate</a>,
a template engine supporting multiple template formats.  This is optional, but
highly recommended for any app requiring templating.</p>

<p><code>scalatra-specs2</code>: This integrates the <a href="https://github.com/etorreborre/specs2">Specs2</a> testing libraries.</p>

<p><code>logback-classic</code>: Basic logging functionality, courtesy of <a href="http://logback.qos.ch/">Logback</a>.</p>

<p><code>jetty-webapp</code>: This is the embedded servlet container used by the web plugin.
Your application should be portable to any servlet container supporting at least
the 2.5 specification.</p>

<p><code>servlet-api</code>: Required for building your app.  It is placed in the <code>provided</code>
configuration so that it is not bundled with your application.  Your servlet
container will provide this at deployment time.</p>


    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
  </body>
</html>